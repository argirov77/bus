<!doctype html>
<html lang="{{ i18n.lang }}">
<head>
  <meta charset="utf-8" />
  <title>{{ page_title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    @page { size: A4; margin: 10mm; }
    @media print { body{-webkit-print-color-adjust:exact; print-color-adjust:exact} }

    :root{
      --brand:#1f4e79;
      --brand2:#0e2e4f;
      --accent:#f28c28;

      --ink:#0f172a;
      --muted:#5f708a;
      --stroke:#e6edf5;
      --bg:#f5f7fb;
      --card:#ffffff;

      --ok:#16a34a;
      --bad:#ef4444;

      --r:16px;
      --pad:14px;
      --gap:14px;

      --fz:14px;
      --fz-sm:12px;
      --fz-xs:11px;

      --city:30px;
      --date:18px;

      --mono: ui-monospace, Menlo, Consolas, monospace;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font:var(--fz)/1.45 Inter, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      orphans:3; widows:3;
    }

    .nowrap{ white-space:nowrap }
    .break{ overflow-wrap:anywhere; word-break:break-word; }

    /* Container */
    .wrap{
      max-width:900px;
      margin:14px auto;
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:18px;
      overflow:hidden;
    }

    /* Top stripe */
    .stripe{
      background:linear-gradient(90deg,var(--brand2),var(--brand));
      color:#fff;
      padding:14px 16px;
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      align-items:center;
      gap:12px;
    }
    .brandline{display:flex;align-items:center;gap:12px;min-width:0}
    .logo{
      width:34px;height:34px;border-radius:12px;
      background:radial-gradient(circle at 30% 30%, #fff 0 35%, var(--brand) 36% 100%);
      flex:0 0 auto;
    }
    .brandname{font-weight:950; letter-spacing:.2px}
    .sub{opacity:.9; font-size:var(--fz-sm); font-weight:700}

    .statusPill{
      justify-self:center;
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.12);
      font-weight:950;
      letter-spacing:.08em;
      font-size:12px;
      white-space:nowrap;
    }
    .statusDot{width:9px;height:9px;border-radius:50%;}
    .statusPill[data-pay="PAID"] .statusDot{background:var(--ok)}
    .statusPill[data-pay="UNPAID"] .statusDot{background:var(--bad)}

    .doc{
      justify-self:end;
      font-family:var(--mono);
      font-size:12px;
      opacity:.9;
      white-space:nowrap;
    }

    /* Main */
    .main{
      padding:var(--pad);
      display:grid;
      grid-template-columns: 1fr 280px;
      gap:var(--gap);
      background:var(--bg);
    }

    .panel{
      background:#fff;
      border:1px solid var(--stroke);
      border-radius:16px;
      overflow:hidden;
    }

    /* HERO (one block) */
    .hero{
      padding:14px 14px 12px;
      border-bottom:1px solid var(--stroke);
    }

    .heroTop{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:14px;
      align-items:start;
    }

    .routeGrid{
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      gap:12px;
      align-items:start;
    }

    .cityCol{display:flex;flex-direction:column;gap:6px;min-width:0}
    .cityCol.right{text-align:right;align-items:flex-end}

    .label{
      font-size:var(--fz-xs);
      letter-spacing:.14em;
      font-weight:950;
      color:var(--muted);
      text-transform:uppercase;
    }
    .city{
      font-size:var(--city);
      font-weight:950;
      line-height:1.05;
      letter-spacing:.01em;
    }
    .arrow{
      font-size:22px;
      font-weight:950;
      color:var(--muted);
      margin-top:18px;
    }

    .time{
      font-family:var(--mono);
      font-variant-numeric: tabular-nums;
      font-size:16px;
      font-weight:950;
      letter-spacing:.01em;
      margin-top:6px;
    }

    /* clickable location */
    a.loc{
      margin-top:2px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      max-width:360px;
      color:var(--brand);
      font-weight:850;
      font-size:var(--fz-sm);
      text-decoration:none;
      border-radius:10px;
      padding:6px 8px;
      margin-left:-8px;
      transition: background .15s ease, filter .15s ease;
    }
    a.loc:hover{ background:rgba(242,245,251,.95); filter:brightness(1.02); }
    a.loc .ext{ font-family:var(--mono); opacity:.7; font-weight:950; }

    .when{
      text-align:right;
      min-width:170px;
    }
    .when .date{
      font-size:var(--date);
      font-weight:950;
      letter-spacing:.01em;
    }
    .when .range{
      margin-top:4px;
      font-family:var(--mono);
      font-variant-numeric: tabular-nums;
      font-size:12px;
      color:var(--muted);
      font-weight:900;
    }

    /* Rows section inside left panel */
    .section{
      padding:12px 14px;
      border-bottom:1px solid var(--stroke);
    }
    .section:last-child{border-bottom:none}

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }

    /* Passenger block (readable) */
    .pRows{display:grid; gap:10px; margin-top:10px}
    .pRow{display:grid; grid-template-columns:90px 1fr; gap:12px; align-items:baseline}
    .pKey{font-size:var(--fz-xs); letter-spacing:.14em; color:var(--muted); font-weight:950; text-transform:uppercase}
    .pVal{font-size:15px; font-weight:900; color:var(--ink)}
    .pVal.mono{font-family:var(--mono); font-variant-numeric: tabular-nums; font-size:13px; font-weight:900; color:#0F2440}

    /* Included pills */
    .included{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .pills{display:flex; gap:10px; flex-wrap:wrap}
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:9px 11px;
      border-radius:999px;
      background: rgba(242,245,251,.92);
      border:1px solid var(--stroke);
      font-size:13px;
      font-weight:950;
      color:var(--ink);
      white-space:nowrap;
    }
    .pill .k{font-size:var(--fz-xs); letter-spacing:.12em; color:var(--muted); font-weight:950; text-transform:uppercase}
    .pill .v{font-family:var(--mono); font-variant-numeric: tabular-nums; font-weight:950}

    /* Right panel: QR + CTA */
    .rightHead{
      padding:12px 14px;
      border-bottom:1px solid var(--stroke);
      font-size:var(--fz-xs);
      letter-spacing:.14em;
      color:var(--muted);
      font-weight:950;
      text-transform:uppercase;
    }
    .qrWrap{padding:14px; display:flex; flex-direction:column; gap:12px; align-items:center}
    .qrBox{
      width:220px; height:220px;
      border:1px solid var(--stroke);
      border-radius:16px;
      display:flex; align-items:center; justify-content:center;
      background:#fff;
      padding:6px;
    }
    .qrBox img{max-width:100%; max-height:100%}
    .qrPlaceholder{color:var(--muted); font-size:var(--fz-sm); text-align:center; line-height:1.35; padding:10px}
    .qrHint{color:var(--muted); font-size:var(--fz-sm); text-align:center; line-height:1.35}

    .cta{padding:14px; border-top:1px solid var(--stroke)}
    .btn{
      display:block;
      width:100%;
      text-align:center;
      padding:11px 12px;
      border-radius:14px;
      background:var(--brand);
      color:#fff;
      border:1px solid var(--brand);
      font-weight:950;
      text-decoration:none;
    }
    .btn:hover{filter:brightness(1.05)}
    .hint{margin-top:8px; color:var(--muted); font-size:var(--fz-sm); line-height:1.35; text-align:center}

    /* Footer */
    .footer{
      border-top:1px solid var(--stroke);
      padding:10px 14px;
      color:var(--muted);
      font-size:var(--fz-sm);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      background:#fff;
    }

    @media (max-width: 860px){
      .main{grid-template-columns:1fr}
      .stripe{grid-template-columns:1fr; justify-items:start}
      .statusPill{justify-self:start}
      .doc{justify-self:start}
      .heroTop{grid-template-columns:1fr}
      .when{text-align:left; min-width:auto}
      .routeGrid{grid-template-columns:1fr; gap:14px}
      .cityCol.right{text-align:left; align-items:flex-start}
      .arrow{display:none}
      .qrBox{width:200px;height:200px}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- STRIPE -->
    <div class="stripe">
      <div class="brandline">
        <div class="logo"></div>
        <div>
          <div class="brandname">{{ i18n.brand_name }}</div>
          <div class="sub">{{ i18n.ticket_label }}</div>
        </div>
      </div>

      {# статус оплаты — делаем понятным #}
      <div class="statusPill"
           data-pay="{% if payment and payment.is_paid %}PAID{% else %}UNPAID{% endif %}">
        <span class="statusDot"></span>
        <span>
          {% if payment and payment.is_paid %}
            {{ i18n.paid_label or 'ОПЛАЧЕН' }}
          {% else %}
            {{ i18n.unpaid_label or 'НЕ ОПЛАЧЕН' }}
          {% endif %}
        </span>
      </div>

      <div class="doc">
        {{ i18n.ticket_number_label }} {{ ticket.number }}
        {% if ticket.order_number %} · {{ i18n.order_label }} {{ ticket.order_number }}{% endif %}
      </div>
    </div>

    <div class="main">
      <!-- LEFT PANEL -->
      <div class="panel">
        <!-- HERO -->
        <div class="hero">
          <div class="heroTop">
            <div class="routeGrid">
              <!-- Departure -->
              <div class="cityCol">
                <div class="label">{{ i18n.departure_label or 'ОТПРАВЛЕНИЕ' }}</div>
                <div class="city">{{ departure.city or route.from_city }}</div>

                {% if departure.time %}
                  <div class="time">{{ departure.time }}</div>
                {% endif %}

                {% if departure.map_url %}
                  <a class="loc" href="{{ departure.map_url }}" target="_blank">
                    <span class="break">
                      {{ departure.address or i18n.view_exact_location }}
                    </span>
                    <span class="ext" aria-hidden="true">↗</span>
                  </a>
                {% elif departure.address %}
                  <div style="margin-top:2px;color:var(--muted);font-weight:850;font-size:var(--fz-sm);line-height:1.25;">
                    {{ departure.address }}
                  </div>
                {% endif %}
              </div>

              <div class="arrow">→</div>

              <!-- Arrival -->
              <div class="cityCol right">
                <div class="label">{{ i18n.arrival_label or 'ПРИБЫТИЕ' }}</div>
                <div class="city">{{ arrival.city or route.to_city }}</div>

                {% if arrival.time %}
                  <div class="time">{{ arrival.time }}</div>
                {% endif %}

                {% if arrival.map_url %}
                  <a class="loc" href="{{ arrival.map_url }}" target="_blank">
                    <span class="break">
                      {{ arrival.address or i18n.view_exact_location }}
                    </span>
                    <span class="ext" aria-hidden="true">↗</span>
                  </a>
                {% elif arrival.address %}
                  <div style="margin-top:2px;color:var(--muted);font-weight:850;font-size:var(--fz-sm);line-height:1.25;">
                    {{ arrival.address }}
                  </div>
                {% endif %}
              </div>
            </div>

            <div class="when">
              {% if ticket.trip_date %}
                <div class="date">{{ ticket.trip_date }}</div>
              {% else %}
                <div class="date">{{ i18n.trip_date_label }}: {{ i18n.value_not_available }}</div>
              {% endif %}
              <div class="range">
                {% if departure.time and arrival.time %}
                  {{ departure.time }} → {{ arrival.time }}
                {% else %}
                  {{ i18n.value_not_available }}
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <!-- PASSENGER -->
        <div class="section">
          <div class="label">{{ i18n.passenger_section or 'ПАССАЖИР' }}</div>
          <div class="pRows">
            <div class="pRow">
              <div class="pKey">{{ i18n.full_name_label or 'ИМЯ' }}</div>
              <div class="pVal">{{ passenger.name }}</div>
            </div>
            {% if passenger.email %}
            <div class="pRow">
              <div class="pKey">EMAIL</div>
              <div class="pVal mono break">{{ passenger.email }}</div>
            </div>
            {% endif %}
            {% if passenger.phone %}
            <div class="pRow">
              <div class="pKey">{{ i18n.phone_label or 'ТЕЛ.' }}</div>
              <div class="pVal mono nowrap">{{ passenger.phone }}</div>
            </div>
            {% endif %}
          </div>
        </div>

        <!-- INCLUDED -->
        <div class="section">
          <div class="included">
            <div class="label">{{ i18n.included_label or 'ВКЛЮЧЕНО' }}</div>
            <div class="pills">
              {% if ticket.seat_number %}
                <div class="pill"><span class="k">{{ i18n.seat_label or 'МЕСТО' }}</span> <span class="v">{{ ticket.seat_number }}</span></div>
              {% endif %}
              {% if ticket.baggage_text %}
                <div class="pill"><span class="k">{{ i18n.baggage_label or 'БАГАЖ' }}</span> <span class="v">{{ ticket.baggage_text }}</span></div>
              {% endif %}
              <div class="pill"><span class="k">{{ i18n.price_label or 'ЦЕНА' }}</span>
                <span class="v">{{ ticket.price_text or i18n.value_not_available }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- OPTIONAL PAYMENT DETAILS (compact) -->
        {% if payment %}
        <div class="section">
          <div class="label">{{ i18n.payment_section or 'ОПЛАТА' }}</div>
          <div class="grid2" style="margin-top:10px">
            <div>
              <div class="label" style="text-transform:none;letter-spacing:0;color:var(--muted);font-weight:850;">{{ i18n.status_label or 'Статус' }}</div>
              <div style="font-weight:950;margin-top:4px; color:{% if payment.is_paid %}var(--ok){% else %}var(--bad){% endif %};">
                {{ payment.status_text }}
              </div>
            </div>
            <div>
              <div class="label" style="text-transform:none;letter-spacing:0;color:var(--muted);font-weight:850;">{{ i18n.method_label or 'Метод' }}</div>
              <div style="font-weight:950;margin-top:4px;">{{ payment.method_text }}</div>
            </div>
          </div>
        </div>
        {% endif %}
      </div>

      <!-- RIGHT PANEL -->
      <div class="panel">
        <div class="rightHead">{{ i18n.scan_label or 'SCAN' }}</div>

        <div class="qrWrap">
          {% if qr_data_uri %}
            <div class="qrBox"><img alt="QR" src="{{ qr_data_uri }}" /></div>
            <div class="qrHint">{{ i18n.qr_hint }}</div>
          {% else %}
            <div class="qrBox"><div class="qrPlaceholder">{{ i18n.qr_unavailable }}</div></div>
          {% endif %}
        </div>

        {% if deep_link %}
        <div class="cta">
          <a class="btn" href="{{ deep_link }}" target="_blank">{{ i18n.manage_online_button }}</a>
          <div class="hint">{{ i18n.manage_online_hint }}</div>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
      <div>{{ i18n.footer_note }}</div>
      <div>{{ i18n.footer_brand }}</div>
    </div>
  </div>
</body>
</html>
