<!doctype html>
<html lang="{{ i18n.lang|default('ru') }}">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>{{ page_title }}</title>

<style>
@page {
  margin: 0;
}
:root{
  --bg:#F2F5FB;
  --paper:#ffffff;
  --ink:#0B1220;
  --muted:#5F708A;
  --line:#E6ECF5;

  --primary:#1E4D7A;
  --primary2:#0E2E4F;

  --ok:#16A34A;
  --bad:#EF4444;

  --shadow:0 18px 45px rgba(15,23,42,.12);

  --font: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:#f5f7fb;
  font-family:var(--font);
  color:var(--ink);
  font-size:14px;
  -webkit-font-smoothing:antialiased;
}

.wrap{
  width:700px;
  margin:12px auto;
  background:var(--paper);
  border-radius:18px;
  overflow:hidden;
}

.break{
  overflow-wrap:anywhere;
  word-break:break-word;
  white-space:normal;
}

/* ===== TOP STRIPE ===== */
.stripe{
  background:#dceeff;
  color:#0B1220;
  padding:14px 18px;
}

.stripeTable{
  width:100%;
  table-layout:fixed;
  border-spacing:0;
  border-collapse:separate;
}

.stripeTable td{
  vertical-align:middle;
}

.brandTable{
  border-spacing:10px 0;
  border-collapse:separate;
}

.brandMark{
  width:36px;height:36px;
  border-radius:12px;
  background:rgba(255,255,255,.15);
  text-align:center;
  vertical-align:middle;
}

.brandMark img{
  width:24px;
  height:auto;
  filter:invert(1) brightness(1.35) contrast(1.2) drop-shadow(0 0 1px rgba(255,255,255,.45));
  display:block;
  margin:0 auto;
}
.brandWord img{
  height:16px;
  filter:invert(1) brightness(1.35) contrast(1.2) drop-shadow(0 0 1px rgba(255,255,255,.45));
  display:inline-block;
  padding:2px 4px;
  border-radius:6px;
  background:rgba(255,255,255,.18);
}

.statusPill{
  display:inline-block;
  padding:8px 14px;
  border-radius:999px;
  font-size:12px;
  font-weight:700;
  letter-spacing:.08em;
  border:1px solid rgba(11,18,32,.18);
  background:rgba(255,255,255,.65);
  color:#0B1220;
  white-space:nowrap;
}

.statusDot{
  width:8px;height:8px;border-radius:50%;
  background:var(--bad);
  display:inline-block;
  vertical-align:middle;
  margin-right:8px;
}

.statusPill[data-pay="PAID"] .statusDot{background:var(--ok)}

.headerMeta{
  text-align:right;
  font-size:14px;
  font-weight:700;
  white-space:nowrap;
  color:#0B1220;
}

/* ===== MAIN GRID (strict math) ===== */
/* inner width = 948px
   left 630 + gap 18 + right 300 = 948 ✅ */
.mainTable{
  width:100%;
  table-layout:fixed;
  border-spacing:12px;
  border-collapse:separate;
}

/* ===== LEFT BOARD ===== */
.board{
  width:100%;
  border:1px solid var(--line);
  border-radius:22px;
  background:#fff;
  overflow:hidden;
}

/* ROUTE */
.route{
  padding:16px 18px;
  border-bottom:1px solid var(--line);
}

.routeTable{
  width:100%;
  table-layout:fixed;
  border-spacing:16px 0;
  border-collapse:separate;
}

.routeTable td{
  vertical-align:top;
}

.city{
  min-width:0;
}

.city.alignRight{text-align:right}

.citySub{
  font-size:11px;
  letter-spacing:.14em;
  font-weight:700;
  color:var(--muted);
  margin-bottom:6px;
}

.cityName{
  font-size:30px;
  font-weight:800;
  letter-spacing:-.01em;
  margin-bottom:6px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.arrow{
  width:34px;
  text-align:center;
  font-size:22px;
  font-weight:700;
  color:var(--muted);
  padding-top:22px;
}

.stopTime{
  font-family:var(--mono);
  font-size:16px;
  font-weight:700;
  margin-bottom:4px;
  white-space:nowrap;
}

.stopLoc{
  font-size:13px;
  color:var(--muted);
  font-weight:600;
  max-width:200px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* PASSENGER */
.passenger{
  padding:14px 18px;
  border-bottom:1px solid var(--line);
}

.sectionLabel{
  font-size:11px;
  letter-spacing:.14em;
  font-weight:700;
  color:var(--muted);
  margin-bottom:10px;
}

.pTable{
  width:100%;
  table-layout:fixed;
  border-spacing:0 8px;
  border-collapse:separate;
}

.pKey{
  font-size:11px;
  letter-spacing:.14em;
  font-weight:700;
  color:var(--muted);
  width:80px;
  vertical-align:top;
}

.pVal{
  font-size:14px;
  font-weight:700;
}

.pVal.mono{
  font-family:var(--mono);
  font-weight:600;
}

/* INCLUDED */
.included{
  padding:14px 18px 16px;
}

.pillsTable{
  width:100%;
  table-layout:fixed;
  border-spacing:10px;
  border-collapse:separate;
}

.pill{
  border:1px solid var(--line);
  background:#F6F8FC;
  border-radius:14px;
  padding:10px 12px;
  vertical-align:top;
}

.pill .k{
  font-size:10px;
  letter-spacing:.14em;
  font-weight:700;
  color:var(--muted);
}

.pill .v{
  margin-top:4px;
  font-family:var(--mono);
  font-size:13px;
  font-weight:700;
}

/* ===== QR ===== */
.qr{
  width:100%;
  border:1px solid var(--line);
  border-radius:22px;
  background:#fff;
  overflow:hidden;
}

.qrHead{
  padding:14px;
  border-bottom:1px solid var(--line);
  font-size:11px;
  letter-spacing:.14em;
  font-weight:700;
  color:var(--muted);
}

.qrBox{
  padding:14px;
  text-align:center;
}

.qrBoxInner{
  width:180px;
  height:180px;
  border:1px solid var(--line);
  border-radius:18px;
  margin:0 auto;
  position:relative;
  overflow:hidden;
  background:#fff;
}

.qrBoxInner img{width:100%;height:100%;display:block}

.qrOffline{
  position:absolute;
  bottom:10px;left:12px;right:12px;
  text-align:center;
  font-size:12px;
  color:var(--muted);
  font-weight:700;
}

.qrFoot{
  padding:14px;
  border-top:1px solid var(--line);
}

.btn{
  display:block;
  width:100%;
  padding:12px;
  border-radius:14px;
  background:var(--primary);
  color:#fff;
  border:none;
  font-size:14px;
  font-weight:800;
  text-align:center;
  text-decoration:none;
}

.btnDisabled{
  background:var(--line);
  color:var(--muted);
}

/* FOOTER */
.footer{
  background:#0B1220;
  color:#fff;
  padding:14px 18px;
}

.footerTable{
  width:100%;
  table-layout:fixed;
  border-spacing:0;
  border-collapse:separate;
  font-size:13px;
}

.footerTable td{
  vertical-align:middle;
  text-align:center;
}

.footerTable td:first-child{
  text-align:left;
}

.footerTable td:last-child{
  text-align:right;
}

.footer a{color:#fff;text-decoration:none}
.footer b{font-weight:800}
</style>
</head>

{% set is_paid = status_chip.css_class == "ok" %}
{% set status_label = i18n.paid_label if is_paid else i18n.unpaid_label %}

<body>
<div class="wrap">
      <div class="stripe">
        <table class="stripeTable">
          <colgroup>
            <col style="width:40%">
            <col style="width:20%">
            <col style="width:40%">
          </colgroup>
          <tr>
            <td>
              <table class="brandTable">
                <tr>
                  <td class="brandMark"><img src="./logo/logo.svg" alt=""></td>
                  <td class="brandWord"><img src="./logo/speling.svg" alt=""></td>
                </tr>
              </table>
            </td>
            <td style="text-align:center;">
              <span class="statusPill" data-pay="{{ 'PAID' if is_paid else 'UNPAID' }}">
                <span class="statusDot"></span>
                <span>{{ status_label }}</span>
              </span>
            </td>
            <td class="headerMeta">{{ ticket.trip_date or i18n.value_not_available }}</td>
          </tr>
        </table>
      </div>

      <table class="mainTable">
        <colgroup>
                  <col style="width:66%">
                  <col style="width:34%">
        </colgroup>
        <tr>
          <td>
            <div class="board">
              <div class="route">
                <table class="routeTable">
                  <colgroup>
                    <col>
                    <col style="width:34px">
                    <col>
                  </colgroup>
                  <tr>
                    <td class="city">
                      <div class="citySub">{{ i18n.departure_label }}</div>
                      <div class="cityName">{{ route.from_city or i18n.value_not_available }}</div>
                      <div class="stopTime">{{ departure.time or i18n.value_not_available }}</div>
                      <div class="stopLoc break">{{ departure.address or i18n.value_not_available }}</div>
                    </td>
                    <td class="arrow">→</td>
                    <td class="city alignRight">
                      <div class="citySub">{{ i18n.arrival_label }}</div>
                      <div class="cityName">{{ route.to_city or i18n.value_not_available }}</div>
                      <div class="stopTime">{{ arrival.time or i18n.value_not_available }}</div>
                      <div class="stopLoc break">{{ arrival.address or i18n.value_not_available }}</div>
                    </td>
                  </tr>
                </table>
              </div>

              <div class="passenger">
                <div class="sectionLabel">{{ i18n.passenger_label|upper }}</div>
                <table class="pTable">
                  <tr>
                    <td class="pKey">{{ i18n.full_name_label }}</td>
                    <td class="pVal">{{ passenger.name or i18n.value_not_available }}</td>
                  </tr>
                  <tr>
                    <td class="pKey">EMAIL</td>
                    <td class="pVal mono break">{{ passenger.email or i18n.value_not_available }}</td>
                  </tr>
                  <tr>
                    <td class="pKey">{{ i18n.phone_label }}</td>
                    <td class="pVal mono break">{{ passenger.phone or i18n.value_not_available }}</td>
                  </tr>
                </table>
              </div>

              <div class="included">
                <div class="sectionLabel">{{ i18n.included_label }}</div>
                <table class="pillsTable">
                  <colgroup>
                    <col style="width:110px">
                    <col>
                    <col style="width:120px">
                  </colgroup>
                  <tr>
                    <td class="pill">
                      <div class="k">{{ i18n.seat_label }}</div>
                      <div class="v">{{ ticket.seat_number or i18n.value_not_available }}</div>
                    </td>
                    <td class="pill">
                      <div class="k">{{ i18n.baggage_label }}</div>
                      <div class="v break">{{ ticket.baggage_text or i18n.value_not_available }}</div>
                    </td>
                    <td class="pill">
                      <div class="k">{{ i18n.price_label }}</div>
                      <div class="v">{{ ticket.price_text or i18n.value_not_available }}</div>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
          </td>
          <td>
            <div class="qr">
              <div class="qrHead">SCAN</div>
              <div class="qrBox">
                <div class="qrBoxInner">
                  {% if qr_data_uri %}
                    <img src="{{ qr_data_uri }}" alt="QR">
                  {% else %}
                    <div class="qrOffline">{{ i18n.qr_unavailable }}</div>
                  {% endif %}
                </div>
              </div>
              <div class="qrFoot">
                {% if deep_link %}
                  <a class="btn" href="{{ deep_link }}">{{ i18n.manage_online_button }}</a>
                {% else %}
                  <span class="btn btnDisabled">{{ i18n.manage_online_button }}</span>
                {% endif %}
              </div>
            </div>
          </td>
        </tr>
      </table>

      <div class="footer">
        <table class="footerTable">
          <tr>
            <td><b>{{ i18n.brand_name }}</b></td>
            <td class="break">{{ i18n.company_phone }}</td>
            <td class="break">{{ i18n.company_email }}</td>
            <td class="break">{{ i18n.company_web }}</td>
          </tr>
        </table>
      </div>

</div>
</body>
</html>
